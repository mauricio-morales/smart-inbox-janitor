<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TrashMailPanda.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="700"
        x:Class="TrashMailPanda.Views.GmailSetupDialog"
        x:DataType="vm:GmailSetupViewModel"
        Title="Gmail OAuth Setup"
        Width="1200" Height="700"
        CanResize="False"
        WindowStartupLocation="CenterScreen"
        Icon="/Assets/avalonia-logo.ico">

    <Design.DataContext>
        <vm:GmailSetupViewModel/>
    </Design.DataContext>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="15" Margin="0,0,0,20">
            <Border Background="#DB4437" Width="40" Height="40" CornerRadius="20">
                <Image Source="/Assets/Logos/gmail-logo.png" Width="20" Height="20"
                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
            <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Gmail OAuth Setup" FontSize="18" FontWeight="Bold"/>
                <TextBlock Text="Configure secure Gmail API access for email processing" FontSize="12" Foreground="Gray"/>
            </StackPanel>
        </StackPanel>

        <!-- Content - 3 Column Layout -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="15"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="15"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Column 1 - Google Cloud Console Setup Instructions -->
            <ScrollViewer Grid.Column="0">
                <StackPanel Spacing="20">
                    <StackPanel Spacing="15">
                        <TextBlock Text="Step 1: Create OAuth Credentials" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimary}"/>
                        <Border Background="{DynamicResource BackgroundPrimary}" Padding="12" CornerRadius="6" BorderBrush="{DynamicResource BorderLight}" BorderThickness="1">
                            <StackPanel Spacing="6">
                                <TextBlock Text="1. Go to Google Cloud Console" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="2. Create or select a project" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="3. Enable the Gmail API" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="4. Go to Credentials page" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="5. Create OAuth 2.0 Client ID" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="6. Choose 'Desktop application'" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="7. Copy Client ID and Secret" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                            </StackPanel>
                        </Border>
                        
                        <Button Command="{Binding OpenGoogleCloudConsoleCommand}"
                                Classes="secondary"
                                HorizontalAlignment="Left"
                                MinWidth="220"
                                Height="40">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="🔗" FontSize="14"/>
                                <TextBlock Text="Open Google Cloud Console" FontSize="13" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Important Notes -->
                    <StackPanel Spacing="15">
                        <TextBlock Text="Important Notes:" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimary}"/>
                        <Border Background="#FFF3E0" Padding="12" CornerRadius="6" BorderBrush="{DynamicResource StatusWarning}" BorderThickness="1">
                            <StackPanel Spacing="8">
                                <TextBlock Text="• Select 'Desktop application' as application type" FontSize="13" Foreground="{DynamicResource TextSecondary}" FontWeight="Medium"/>
                                <TextBlock Text="• No need to configure redirect URIs in Console" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="• Keep your Client Secret secure" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="• Gmail API must be enabled for your project" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
            
            <!-- Column 2 - OAuth Client Configuration -->
            <ScrollViewer Grid.Column="2">
                <StackPanel Spacing="20">
                    <StackPanel Spacing="15">
                        <TextBlock Text="Step 2: Enter OAuth Credentials" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimary}"/>
                        
                        <!-- Status Display -->
                        <Border Background="{DynamicResource BackgroundPrimary}" 
                                Padding="12" 
                                CornerRadius="6"
                                BorderBrush="{DynamicResource BorderLight}" 
                                BorderThickness="1">
                            <TextBlock Text="{Binding ClientCredentialsStatusText}" 
                                      FontSize="12" 
                                      Foreground="{DynamicResource TextTertiary}"
                                      TextWrapping="Wrap"/>
                        </Border>
                    </StackPanel>

                    <!-- Client ID Input -->
                    <StackPanel Spacing="12">
                        <TextBlock Text="OAuth Client ID" FontWeight="SemiBold" FontSize="14" Foreground="{DynamicResource TextPrimary}"/>
                        <TextBox Text="{Binding ClientId}"
                                 Watermark="123456789-abcdefg.googleusercontent.com"
                                 MinHeight="45"
                                 FontSize="13"
                                 Padding="12"
                                 BorderBrush="{DynamicResource BorderMedium}"
                                 BorderThickness="1"
                                 CornerRadius="6"
                                 FontFamily="Consolas, Monaco, 'Courier New', monospace"/>
                    </StackPanel>

                    <!-- Client Secret Input -->
                    <StackPanel Spacing="12">
                        <TextBlock Text="OAuth Client Secret" FontWeight="SemiBold" FontSize="14" Foreground="{DynamicResource TextPrimary}"/>
                        <TextBox Text="{Binding ClientSecret}"
                                 PasswordChar="*"
                                 Watermark="GOCSPX-..."
                                 MinHeight="45"
                                 FontSize="13"
                                 Padding="12"
                                 BorderBrush="{DynamicResource BorderMedium}"
                                 BorderThickness="1"
                                 CornerRadius="6"
                                 FontFamily="Consolas, Monaco, 'Courier New', monospace"/>
                    </StackPanel>

                    <!-- Redirect URI (Auto-configured) -->
                    <StackPanel Spacing="12">
                        <TextBlock Text="Redirect URI (Auto-configured)" FontWeight="SemiBold" FontSize="14" Foreground="{DynamicResource TextPrimary}"/>
                        <TextBox Text="{Binding RedirectUri}"
                                 IsReadOnly="True"
                                 MinHeight="45"
                                 FontSize="13"
                                 Padding="12"
                                 Background="{DynamicResource BackgroundPrimary}"
                                 BorderBrush="{DynamicResource BorderLight}"
                                 BorderThickness="1"
                                 CornerRadius="6"
                                 FontFamily="Consolas, Monaco, 'Courier New', monospace"/>
                        <TextBlock Text="This is automatically configured for desktop OAuth flow" 
                                  FontSize="11" 
                                  Foreground="{DynamicResource TextTertiary}"
                                  TextWrapping="Wrap"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
            
            <!-- Column 3 - Authentication & Status -->
            <ScrollViewer Grid.Column="4">
                <StackPanel Spacing="20">
                    <StackPanel Spacing="15">
                        <TextBlock Text="Step 3: Authentication" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimary}"/>
                        
                        <Border Background="{DynamicResource BackgroundPrimary}" Padding="12" CornerRadius="6" BorderBrush="{DynamicResource BorderLight}" BorderThickness="1">
                            <StackPanel Spacing="8">
                                <TextBlock Text="After saving OAuth credentials:" FontSize="13" FontWeight="Medium" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="• Browser window will open" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="• Sign in to your Gmail account" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="• Grant TrashMail Panda access" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                                <TextBlock Text="• Access tokens will be saved securely" FontSize="13" Foreground="{DynamicResource TextSecondary}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Validation Message -->
                    <Border IsVisible="{Binding !!ValidationMessage}"
                            Classes="ErrorCard"
                            Padding="16" 
                            CornerRadius="6">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="⚠️" FontSize="16"/>
                            <TextBlock Text="{Binding ValidationMessage}" 
                                      FontSize="13" 
                                      Foreground="{DynamicResource StatusError}"
                                      TextWrapping="Wrap"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Success Message -->
                    <Border IsVisible="{Binding IsValidated}"
                            Background="#E8F5E8" 
                            Padding="16" 
                            CornerRadius="6"
                            BorderBrush="{DynamicResource StatusSuccess}" 
                            BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <TextBlock Text="✅" FontSize="16"/>
                            <TextBlock Text="OAuth credentials saved! Gmail authentication will begin..." 
                                      FontSize="13" 
                                      Foreground="{DynamicResource StatusSuccess}"
                                      TextWrapping="Wrap"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <!-- Status Message -->
                    <Border IsVisible="{Binding !!StatusMessage}"
                            Background="{DynamicResource BackgroundPrimary}"
                            Padding="12"
                            CornerRadius="6"
                            BorderBrush="{DynamicResource BorderLight}"
                            BorderThickness="1">
                        <TextBlock Text="{Binding StatusMessage}" 
                                  FontSize="12" 
                                  Foreground="{DynamicResource TextTertiary}"
                                  TextWrapping="Wrap"/>
                    </Border>

                    <!-- Reference Links -->
                    <StackPanel Spacing="10">
                        <TextBlock Text="Need Help?" FontWeight="SemiBold" FontSize="14" Foreground="{DynamicResource TextPrimary}"/>
                        <Button Command="{Binding OpenGmailApiDocsCommand}"
                                Classes="secondary"
                                HorizontalAlignment="Left"
                                MinWidth="180"
                                Height="35">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="📖" FontSize="12"/>
                                <TextBlock Text="Gmail API Docs" FontSize="12" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        
                        <Button Command="{Binding ClearAllCredentialsCommand}"
                                Classes="secondary"
                                HorizontalAlignment="Left"
                                MinWidth="180"
                                Height="35"
                                IsVisible="{Binding HasExistingCredentials}">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <TextBlock Text="🗑️" FontSize="12"/>
                                <TextBlock Text="Clear All Credentials" FontSize="12" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10" Margin="0,20,0,0">
            <Button Command="{Binding CancelCommand}"
                    Content="Cancel"
                    Classes="secondary"
                    MinWidth="80"
                    Height="35"/>
            
            <Button Command="{Binding ValidateAndSaveCommand}"
                    IsEnabled="{Binding CanSave}"
                    Classes="primary"
                    MinWidth="150"
                    Height="35"
                    IsDefault="True">
                <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="💾" FontSize="12" IsVisible="{Binding !IsValidating}"/>
                    <TextBlock Text="⏳" FontSize="12" IsVisible="{Binding IsValidating}"/>
                    <TextBlock Text="{Binding SaveButtonText}" FontSize="12" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </StackPanel>
    </Grid>

</Window>