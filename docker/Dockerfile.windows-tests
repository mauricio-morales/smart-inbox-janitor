# Windows container for DPAPI-specific testing
# NOTE: Windows containers require Docker Desktop with Windows containers enabled
# and can only run on Windows hosts

FROM mcr.microsoft.com/dotnet/sdk:9.0-nanoserver-ltsc2022 AS base

# Set working directory
WORKDIR C:\app

# Copy all source code
COPY . .

# Restore dependencies (after copying all source)
RUN dotnet restore

# Build the solution
RUN dotnet build --configuration Release --no-restore

# Default command runs Windows-specific tests
CMD ["dotnet", "test", "--configuration", "Release", "--no-build", "--filter", "Category=Integration&Platform=Windows", "--verbosity", "normal", "--logger", "console;verbosity=detailed"]